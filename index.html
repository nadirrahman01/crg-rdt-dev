<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cordoba Research Group â€” RDT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Core styles -->
  <link rel="stylesheet" href="assets/styles.css" />

  <!-- Chart.js for price chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- docx + FileSaver for Word export -->
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
</head>

<body>
  <!-- =======================================================
       Institutional Shell
       ======================================================= -->
  <div class="app-shell">
    <!-- Topbar -->
    <div class="topbar">
      <div class="topbar-left">
        <div class="brand-badge" aria-hidden="true">CRG</div>
        <div class="brand-stack">
          <div class="brand-title">Cordoba Research Group</div>
          <div class="brand-subtitle">Research Documentation Tool Â· Institutional Template</div>
        </div>
      </div>

      <div class="topbar-right">
        <div class="status-pill">
          Draft: <span id="draftStatus">â€”</span>
        </div>
        <div class="status-pill">
          Completion: <span id="completionText">â€”</span>
        </div>
      </div>
    </div>

    <!-- Body -->
    <div class="shell-body">
      <!-- =====================================================
           Main pane (authoring)
           ===================================================== -->
      <div class="main-pane">
        <div class="container" style="box-shadow:none;border:0;padding:0;background:transparent;">
          <div class="hero">
            <div>
              <div class="hero-title">Research Note Builder</div>
              <div class="hero-subtitle">Write cleanly, export in sell-side format, and keep drafts autosaved.</div>
            </div>
            <div class="institutional-footer" style="text-align:right;">
              <div style="font-size:12px;color:rgba(11,14,20,.58);font-weight:600;text-transform:uppercase;letter-spacing:.2px;">
                Internal Use
              </div>
              <div style="font-size:12.5px;color:rgba(11,14,20,.58);">
                CÃ³rdoba Â· Gold Standard Formatting
              </div>
            </div>
          </div>

          <!-- Progress -->
          <div class="progress-wrap" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="progress-label">Publish readiness</div>
            <div class="progress-bar"><div id="completionBar" class="progress-fill"></div></div>
          </div>

          <!-- Message -->
          <div id="message" class="message" style="display:none;"></div>

          <!-- =====================================================
               Form
               ===================================================== -->
          <form id="researchForm" novalidate>
            <!-- NOTE TYPE -->
            <label for="noteType">Note Type</label>
            <select id="noteType" required>
              <option value="">Selectâ€¦</option>
              <option value="Macro Research">Macro Research</option>
              <option value="Fixed Income Research">Fixed Income Research</option>
              <option value="Commodity Insights">Commodity Insights</option>
              <option value="Equity Research">Equity Research</option>
              <option value="General Note">General Note</option>
            </select>

            <!-- TITLE -->
            <label for="title">Title</label>
            <input id="title" type="text" placeholder="e.g. Rebalancing Act: How Policy Shifts Are Rewriting Trade" required />

            <!-- TOPIC -->
            <label for="topic">Topic</label>
            <input id="topic" type="text" placeholder="e.g. Global Macro Â· Rates Â· Policy Â· Equity Strategy" required />

            <!-- AUTHOR -->
            <div class="panel">
              <div class="panel-head">
                <div class="panel-title">Author details</div>
                <div class="panel-muted">Shown on the cover and header.</div>
              </div>

              <label for="authorLastName" style="margin-top:0;">Last Name</label>
              <input id="authorLastName" type="text" placeholder="RAHMAN" autocomplete="family-name" required />

              <label for="authorFirstName">First Name</label>
              <input id="authorFirstName" type="text" placeholder="Nadir" autocomplete="given-name" required />

              <label>Phone</label>
              <div class="phone-row">
                <select id="authorPhoneCountry" class="phone-country" aria-label="Country code">
                  <option value="44" selected>ğŸ‡¬ğŸ‡§ +44</option>
                  <option value="1">ğŸ‡ºğŸ‡¸ +1</option>
                  <option value="353">ğŸ‡®ğŸ‡ª +353</option>
                  <option value="33">ğŸ‡«ğŸ‡· +33</option>
                  <option value="49">ğŸ‡©ğŸ‡ª +49</option>
                  <option value="31">ğŸ‡³ğŸ‡± +31</option>
                  <option value="34">ğŸ‡ªğŸ‡¸ +34</option>
                  <option value="39">ğŸ‡®ğŸ‡¹ +39</option>
                  <option value="971">ğŸ‡¦ğŸ‡ª +971</option>
                  <option value="966">ğŸ‡¸ğŸ‡¦ +966</option>
                  <option value="92">ğŸ‡µğŸ‡° +92</option>
                  <option value="880">ğŸ‡§ğŸ‡© +880</option>
                  <option value="91">ğŸ‡®ğŸ‡³ +91</option>
                  <option value="234">ğŸ‡³ğŸ‡¬ +234</option>
                  <option value="254">ğŸ‡°ğŸ‡ª +254</option>
                  <option value="27">ğŸ‡¿ğŸ‡¦ +27</option>
                  <option value="995">ğŸ‡¬ğŸ‡ª +995</option>
                  <option value="">Other</option>
                </select>

                <input
                  id="authorPhoneNational"
                  class="phone-number"
                  type="text"
                  inputmode="numeric"
                  autocomplete="tel-national"
                  placeholder="e.g. 7400 123 456"
                />
              </div>

              <!-- Hidden field used by JS/Word export -->
              <input id="authorPhone" type="text" style="display:none;" />
            </div>

            <!-- CO-AUTHORS -->
            <div class="panel">
              <div class="panel-head">
                <div class="panel-title">Co-authors</div>
                <button type="button" class="btn btn-secondary" id="addCoAuthor">Add co-author</button>
              </div>

              <div id="coAuthorsList"></div>
            </div>

            <!-- KEY TAKEAWAYS -->
            <label for="keyTakeaways">Key Takeaways (bullets)</label>
            <textarea
              id="keyTakeaways"
              placeholder="- One line per takeaway&#10;- Keep it tight and investor-facing"
              required
            ></textarea>

            <!-- ANALYSIS -->
            <label for="analysis">Analysis</label>
            <textarea
              id="analysis"
              placeholder="Write the main body. Use short paragraphs. Mention Figure numbers inline if needed."
              required
            ></textarea>

            <!-- OPTIONAL CONTENT -->
            <label for="content">Additional Detail (optional)</label>
            <textarea
              id="content"
              placeholder="Extra context, background, longer-form detail. Optional."
            ></textarea>

            <!-- CORDOBA VIEW -->
            <label for="cordobaView">The Cordoba View (optional but recommended)</label>
            <textarea
              id="cordobaView"
              placeholder="What we think at Cordoba. Your differentiated view and positioning."
            ></textarea>

            <!-- FIGURES -->
            <div class="panel">
              <div class="panel-head">
                <div class="panel-title">Figures & Charts</div>
                <div class="panel-muted">Upload images at the end. Theyâ€™ll be appended as a Figures section.</div>
              </div>

              <label for="imageUpload" style="margin-top:0;">Upload images</label>
              <input id="imageUpload" type="file" accept="image/*" multiple />
              <div class="help-text">Tip: name files clearly (e.g. â€œFigure 1 - Yield Curve.pngâ€).</div>
            </div>

            <!-- =====================================================
                 EQUITY SECTION (toggles by Note Type)
                 ===================================================== -->
            <div id="equitySection" class="equity-section" style="display:none;">
              <div class="equity-header">
                <div class="equity-title">Equity Tear Sheet</div>
                <div class="equity-subtitle">Optional fields, but recommended for a true sell-side output.</div>
              </div>

              <label for="ticker" style="margin-top:0;">Ticker (Stooq)</label>
              <input id="ticker" type="text" placeholder="e.g. AAPL or aapl.us or bp.uk" />
              <div class="ticker-microtext">
                Data source: Stooq via proxy
                <span class="ticker-dot">Â·</span>
                Use <a class="ticker-link" href="https://stooq.com/" target="_blank" rel="noopener">stooq.com</a> format (e.g. <b>aapl.us</b>).
              </div>

              <div class="rating-row">
                <label class="rating-label" for="crgRating" style="margin-top:0;">
                  CRG Rating (required for Equity)
                  <span class="info-badge" tabindex="0" aria-label="Rating info">i</span>
                  <span class="info-pop">
                    <b>CRG Rating</b> is a house view signal. Keep it consistent and defensible.
                    <br><br>
                    <b>Buy</b>: upside skewed, catalysts exist, risks understood.
                    <br>
                    <b>Hold</b>: fairly priced / balanced risks.
                    <br>
                    <b>Sell</b>: downside skewed, valuation stretched or thesis impaired.
                  </span>
                </label>
                <select id="crgRating" class="crg-rating-select">
                  <option value="">Selectâ€¦</option>
                  <option value="Buy">Buy</option>
                  <option value="Hold">Hold</option>
                  <option value="Sell">Sell</option>
                </select>
              </div>

              <label for="targetPrice">Target Price (optional)</label>
              <input id="targetPrice" type="text" placeholder="e.g. 210" />

              <!-- Price chart -->
              <div class="chart-panel">
                <div class="chart-head">
                  <div class="chart-title">Price chart</div>
                  <div class="chart-actions">
                    <select id="chartRange" class="chart-range" aria-label="Chart range">
                      <option value="6mo">6M</option>
                      <option value="1y" selected>1Y</option>
                      <option value="2y">2Y</option>
                      <option value="5y">5Y</option>
                    </select>
                    <button type="button" id="fetchPriceChart" class="btn btn-secondary">Fetch chart</button>
                  </div>
                </div>

                <div class="chart-wrap" style="height:260px;">
                  <canvas id="priceChart"></canvas>
                </div>

                <div class="help-text" id="chartStatus" style="margin-top:10px;"> </div>

                <div class="metrics-grid">
                  <div class="metric-card">
                    <div class="metric-label">Current price</div>
                    <div class="metric-value" id="currentPrice">â€”</div>
                  </div>
                  <div class="metric-card">
                    <div class="metric-label">Return (range)</div>
                    <div class="metric-value" id="rangeReturn">â€”</div>
                  </div>
                  <div class="metric-card">
                    <div class="metric-label">Volatility (ann.)</div>
                    <div class="metric-value" id="realisedVol">â€”</div>
                  </div>
                  <div class="metric-card">
                    <div class="metric-label">Upside to target</div>
                    <div class="metric-value" id="upsideToTarget">â€”</div>
                  </div>
                </div>
              </div>

              <!-- Model / valuation -->
              <div class="panel">
                <div class="panel-head">
                  <div class="panel-title">Valuation & model</div>
                  <div class="panel-muted">Used in Tear Sheet appendix.</div>
                </div>

                <label for="valuationSummary" style="margin-top:0;">Valuation Summary (optional)</label>
                <textarea id="valuationSummary" placeholder="e.g. DCF implies fair value; key debate is margin durability."></textarea>

                <label for="keyAssumptions">Key Assumptions (optional bullets)</label>
                <textarea id="keyAssumptions" placeholder="- Revenue CAGR&#10;- Margin path&#10;- WACC / terminal growth"></textarea>

                <label for="scenarioNotes">Scenario / Sensitivity Notes (optional)</label>
                <textarea id="scenarioNotes" placeholder="Bull/Base/Bear assumptions, sensitivities, what breaks the thesis."></textarea>

                <label for="modelLink">Model link (optional)</label>
                <input id="modelLink" type="text" placeholder="https://â€¦" />

                <label for="modelFiles">Upload model files (optional)</label>
                <input id="modelFiles" type="file" multiple />

                <div class="attachment-summary">
                  <div id="attachmentSummaryHead" class="attachment-summary-head">No files selected</div>
                  <div id="attachmentSummaryList" class="attachment-summary-list" style="display:none;"></div>
                </div>
              </div>
            </div>

            <!-- Guidance -->
            <div class="tool-info">
              <div class="tool-info-title">Workflow note</div>
              <div class="tool-info-text">
                If you reference a chart or figure in your write-up, mention it as â€œFigure Xâ€.
                Images are appended at the end of the Word export.
              </div>
            </div>

            <!-- Actions -->
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Generate Word Document</button>
              <button type="button" id="emailToCrgBtn" class="btn btn-secondary">Email to CRG</button>
              <button type="button" id="resetFormBtn" class="btn btn-secondary">Reset</button>
            </div>
          </form>
        </div>
      </div>

      <!-- =====================================================
           Right rail (publish controls / compliance / tips)
           ===================================================== -->
      <aside class="right-rail">
        <div class="rail-card" style="margin-bottom:14px;">
          <div class="rail-title">Publish checklist</div>
          <div class="rail-text">
            Your Word export is built to a sell-side rhythm:
            cover banner, sidebar contents, overview rail, then sections.
            Keep takeaways short and investor-facing.
          </div>
          <div style="height:12px;"></div>
          <div class="rail-text">
            <b>Equity notes:</b> Fetch the chart before export to embed the tear sheet chart and stats.
          </div>
        </div>

        <div class="rail-card" style="margin-bottom:14px;">
          <div class="rail-title">Compliance</div>
          <div class="rail-text">
            Internal use only. Validate tickers, charts, prices, and any forward-looking statements before distribution.
          </div>
        </div>

        <div class="rail-card">
          <div class="rail-title">Quick tips</div>
          <div class="rail-text">
            Use short paragraphs. Avoid long lists in the analysis body. If you need bullets, keep them in â€œKey Takeawaysâ€.
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- App script (must be last) -->
  <script src="assets/app.js"></script>
</body>
</html>
