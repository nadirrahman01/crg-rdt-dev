<!-- ============================================================
     CRG RDT — index.html (Institutional / BlueMatrix feel)
     - Matches IDs used by your updated app.js
     - Keeps Córdoba theme hooks for styles.css
     - Removes “extra” UI copy (you can add any back if needed)
     ============================================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CRG — Research Drafting Tool (RDT)</title>

  <link rel="stylesheet" href="./styles.css" />

  <!-- Docx + FileSaver (required for Word export) -->
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <!-- Chart.js (required for price chart) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <!-- Top bar -->
  <header class="topbar">
    <div class="topbar__left">
      <div class="brand">
        <div class="brand__mark" aria-hidden="true"></div>
        <div class="brand__text">
          <div class="brand__title">Cordoba Research Group</div>
          <div class="brand__sub">Research Drafting Tool</div>
        </div>
      </div>
    </div>

    <div class="topbar__right">
      <div class="topmeta">
        <div class="topmeta__item">
          <span class="topmeta__label">Session</span>
          <span class="topmeta__value" id="sessionTimer">00:00</span>
        </div>
        <div class="topmeta__item">
          <span class="topmeta__label">Version</span>
          <span class="topmeta__value" id="versionDisplay">v1.0</span>
        </div>
        <div class="topmeta__item">
          <span class="topmeta__label">Draft watermark</span>
          <span class="topmeta__value" id="watermarkBadge">ON (Draft)</span>
        </div>
        <div class="topmeta__item">
          <span class="topmeta__label">Autosave</span>
          <span class="topmeta__value" id="autosaveStatus">—</span>
        </div>
      </div>
    </div>
  </header>

  <main class="layout">
    <!-- Left: Form -->
    <section class="main">
      <form id="researchForm" class="card card--main">
        <!-- Header strip -->
        <div class="card__head">
          <div class="card__head-left">
            <h1 class="h1">Note builder</h1>
            <div class="muted">Fill the required fields, then export to Word.</div>
          </div>
          <div class="card__head-right">
            <div class="segmented" role="group" aria-label="Distribution preset">
              <button type="button" class="segmented__btn" id="presetInternal">Internal</button>
              <button type="button" class="segmented__btn" id="presetPublic">Public</button>
              <button type="button" class="segmented__btn" id="presetClient">Client-safe</button>
            </div>

            <!-- Hidden preset value used by app.js -->
            <input type="hidden" id="distPreset" value="internal" />
            <span class="badge" id="distPresetLabel">Internal only</span>
          </div>
        </div>

        <div class="card__body">
          <!-- Template + Type -->
          <section class="section">
            <div class="grid grid--2">
              <div class="field">
                <label for="template">Template</label>
                <select id="template">
                  <option value="">Select…</option>
                  <option value="macro">Macro</option>
                  <option value="equity">Equity</option>
                  <option value="event">Event / News</option>
                </select>
              </div>

              <div class="field">
                <label for="noteType">Note type</label>
                <select id="noteType" required>
                  <option value="">Select…</option>
                  <option value="Macro Research">Macro Research</option>
                  <option value="Equity Research">Equity Research</option>
                  <option value="General Note">General Note</option>
                </select>
              </div>
            </div>

            <div class="grid grid--2">
              <div class="field">
                <label for="topic">Topic</label>
                <input id="topic" type="text" placeholder="e.g., Indonesia FX, Uranium, UK Rates" required />
              </div>

              <div class="field">
                <label for="title">Title</label>
                <input id="title" type="text" placeholder="Short, direct title" required />
              </div>
            </div>
          </section>

          <!-- Workflow -->
          <section class="section" id="sec-review">
            <div class="grid grid--3">
              <div class="field">
                <label for="status">Status</label>
                <select id="status" required>
                  <option value="Draft" selected>Draft</option>
                  <option value="Reviewed">Reviewed</option>
                  <option value="Cleared">Cleared</option>
                </select>
              </div>

              <div class="field">
                <label for="reviewedBy">Reviewed by</label>
                <select id="reviewedBy">
                  <option value="">Select…</option>
                </select>
              </div>

              <div class="field">
                <label for="changeNote">Change note</label>
                <input id="changeNote" type="text" placeholder="Optional (e.g., Updated data / revised thesis)" />
              </div>
            </div>

            <div class="grid grid--2">
              <div class="field field--inline">
                <input id="bumpMajor" type="checkbox" />
                <label for="bumpMajor" class="label-inline">Bump major version on export</label>
              </div>

              <div class="field field--inline field--right">
                <button type="button" class="btn btn-ghost" id="clearAutosave">Clear autosave</button>
                <button type="button" class="btn btn-ghost" id="resetFormBtn">Reset form</button>
              </div>
            </div>
          </section>

          <!-- Executive Summary -->
          <section class="section">
            <div class="section__head">
              <div>
                <h2 class="h2">Executive summary</h2>
              </div>
              <div class="toggle">
                <input id="autoExecSummary" type="checkbox" />
                <label for="autoExecSummary">Auto-generate</label>
              </div>
            </div>

            <div class="field">
              <textarea id="execSummary" rows="8" placeholder="Optional (or enable auto-generate)."></textarea>
              <div class="field__meta">
                <span class="pill" id="execWords">0 words</span>
              </div>
            </div>
          </section>

          <!-- Author -->
          <section class="section">
            <div class="section__head">
              <h2 class="h2">Author</h2>
            </div>

            <div class="grid grid--2">
              <div class="field">
                <label for="authorLastName">Last name</label>
                <input id="authorLastName" type="text" required />
              </div>
              <div class="field">
                <label for="authorFirstName">First name</label>
                <input id="authorFirstName" type="text" required />
              </div>
            </div>

            <div class="grid grid--2">
              <div class="field">
                <label>Phone</label>
                <div class="phone-row">
                  <select id="authorPhoneCountry" class="phone-country" aria-label="Country code">
                    <option value="44" selected>+44</option>
                    <option value="1">+1</option>
                    <option value="353">+353</option>
                    <option value="33">+33</option>
                    <option value="49">+49</option>
                    <option value="31">+31</option>
                    <option value="34">+34</option>
                    <option value="39">+39</option>
                    <option value="971">+971</option>
                    <option value="966">+966</option>
                    <option value="92">+92</option>
                    <option value="880">+880</option>
                    <option value="91">+91</option>
                    <option value="234">+234</option>
                    <option value="254">+254</option>
                    <option value="27">+27</option>
                    <option value="995">+995</option>
                    <option value="">Other</option>
                  </select>

                  <input
                    id="authorPhoneNational"
                    class="phone-number"
                    type="text"
                    inputmode="numeric"
                    placeholder="National number"
                  />
                </div>

                <!-- Hidden (international format) -->
                <input id="authorPhone" type="text" style="display:none;" />
              </div>

              <div class="field">
                <label>Co-authors</label>
                <div class="coauthors">
                  <div id="coAuthorsList" class="coauthors__list"></div>
                  <button type="button" class="btn btn-ghost" id="addCoAuthor">Add co-author</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Core content -->
          <section class="section">
            <div class="section__head">
              <h2 class="h2">Key takeaways</h2>
              <span class="pill" id="takeawaysWords">0 words</span>
            </div>

            <div class="field">
              <textarea id="keyTakeaways" rows="7" required placeholder="- …"></textarea>
            </div>
          </section>

          <section class="section">
            <div class="section__head">
              <h2 class="h2">Analysis and commentary</h2>
              <span class="pill" id="analysisWords">0 words</span>
            </div>

            <div class="field">
              <textarea id="analysis" rows="12" required></textarea>
            </div>
          </section>

          <section class="section">
            <div class="section__head">
              <h2 class="h2">Additional content</h2>
              <span class="pill" id="contentWords">0 words</span>
            </div>

            <div class="field">
              <textarea id="content" rows="10" placeholder="Optional appendix / data notes"></textarea>
            </div>
          </section>

          <section class="section">
            <div class="section__head">
              <h2 class="h2">The Cordoba view</h2>
              <span class="pill" id="viewWords">0 words</span>
            </div>

            <div class="field">
              <textarea id="cordobaView" rows="10" required></textarea>
            </div>
          </section>

          <!-- Equity (conditional) -->
          <section class="section" id="sec-equity" style="display:none;">
            <div class="section__head">
              <h2 class="h2">Equity addendum</h2>
            </div>

            <div class="grid grid--3">
              <div class="field">
                <label for="ticker">Ticker (Stooq)</label>
                <input id="ticker" type="text" placeholder="e.g., MSFT or 7203.JP" />
              </div>

              <div class="field">
                <label for="crgRating">CRG rating</label>
                <select id="crgRating">
                  <option value="">Select…</option>
                  <option value="Buy">Buy</option>
                  <option value="Hold">Hold</option>
                  <option value="Sell">Sell</option>
                </select>
              </div>

              <div class="field">
                <label for="targetPrice">Target price</label>
                <input id="targetPrice" type="text" placeholder="e.g., 125.00" />
              </div>
            </div>

            <div class="grid grid--2">
              <div class="field">
                <label for="modelLink">Model link</label>
                <input id="modelLink" type="url" placeholder="https://…" />
              </div>

              <div class="field">
                <label for="modelFiles">Model files</label>
                <input id="modelFiles" type="file" multiple />
                <div class="attach-summary">
                  <div class="attach-summary__head" id="attachmentSummaryHead">No files selected</div>
                  <div class="attach-summary__list" id="attachmentSummaryList" style="display:none;"></div>
                </div>
              </div>
            </div>

            <div class="grid grid--2">
              <div class="field">
                <label for="valuationSummary">Valuation summary</label>
                <textarea id="valuationSummary" rows="8"></textarea>
              </div>
              <div class="field">
                <label for="keyAssumptions">Key assumptions</label>
                <textarea id="keyAssumptions" rows="8" placeholder="- …"></textarea>
              </div>
            </div>

            <div class="field">
              <label for="scenarioNotes">Scenario / sensitivity notes</label>
              <textarea id="scenarioNotes" rows="7"></textarea>
            </div>

            <div class="grid grid--3">
              <div class="field">
                <label for="scBearPrice">Bear price</label>
                <input id="scBearPrice" type="text" />
              </div>
              <div class="field">
                <label for="scBasePrice">Base price</label>
                <input id="scBasePrice" type="text" />
              </div>
              <div class="field">
                <label for="scBullPrice">Bull price</label>
                <input id="scBullPrice" type="text" />
              </div>
            </div>

            <div class="grid grid--3">
              <div class="field">
                <label for="scBearAssump">Bear assumption</label>
                <input id="scBearAssump" type="text" />
              </div>
              <div class="field">
                <label for="scBaseAssump">Base assumption</label>
                <input id="scBaseAssump" type="text" />
              </div>
              <div class="field">
                <label for="scBullAssump">Bull assumption</label>
                <input id="scBullAssump" type="text" />
              </div>
            </div>

            <!-- Chart area -->
            <div class="subcard">
              <div class="subcard__head">
                <div class="subcard__title">Price chart</div>
                <div class="subcard__actions">
                  <select id="chartRange" class="select--compact" aria-label="Chart range">
                    <option value="6mo" selected>6M</option>
                    <option value="1y">1Y</option>
                    <option value="2y">2Y</option>
                    <option value="5y">5Y</option>
                  </select>
                  <button type="button" class="btn btn-primary" id="fetchPriceChart">Fetch</button>
                </div>
              </div>

              <div class="subcard__body">
                <div class="chart-wrap">
                  <canvas id="priceChart"></canvas>
                </div>

                <div class="chart-meta">
                  <div class="chart-meta__left">
                    <div class="kv"><span class="kv__k">Current</span><span class="kv__v" id="currentPrice">—</span></div>
                    <div class="kv"><span class="kv__k">Vol (ann.)</span><span class="kv__v" id="realisedVol">—</span></div>
                    <div class="kv"><span class="kv__k">Return (range)</span><span class="kv__v" id="rangeReturn">—</span></div>
                    <div class="kv"><span class="kv__k">Upside to target</span><span class="kv__v" id="upsideToTarget">—</span></div>
                  </div>

                  <div class="chart-meta__right">
                    <div class="field field--compact">
                      <label for="chartDataSource">Data source</label>
                      <input id="chartDataSource" type="text" placeholder="Stooq / Bloomberg / Refinitiv" />
                    </div>
                    <div class="field field--compact">
                      <label for="chartDataSourceNote">Source note</label>
                      <input id="chartDataSourceNote" type="text" placeholder="Optional" />
                    </div>
                    <div class="field field--compact">
                      <label for="chartAnnotation">Chart annotation</label>
                      <input id="chartAnnotation" type="text" placeholder="Optional (e.g., post-event spike)" />
                    </div>

                    <div class="muted" id="chartStatus"></div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Figures -->
          <section class="section">
            <div class="section__head">
              <h2 class="h2">Figures and charts</h2>
            </div>
            <div class="field">
              <label for="imageUpload">Upload images</label>
              <input id="imageUpload" type="file" multiple accept="image/*" />
            </div>
          </section>

          <!-- Final -->
          <section class="section">
            <div class="section__head">
              <h2 class="h2">Export</h2>
            </div>

            <div class="attest">
              <input id="attestDraft" type="checkbox" />
              <label for="attestDraft">I confirm the draft is ready to export.</label>
            </div>

            <div class="actions">
              <button type="button" class="btn btn-ghost" id="emailToCrgBtn">Email routing</button>
              <button type="submit" class="btn btn-primary" id="generateBtn">Generate Word Document</button>
            </div>

            <div id="message" class="message" aria-live="polite"></div>
          </section>
        </div>
      </form>
    </section>

    <!-- Right: Rail -->
    <aside class="rail">
      <div class="card card--rail">
        <div class="rail__row">
          <div class="rail__k">Completion</div>
          <div class="rail__v">
            <span id="completionText">0 / 0</span>
            <span class="muted" id="completionPct">0%</span>
          </div>
        </div>

        <div class="progress">
          <div class="progress__bar" id="completionBar" style="width:0%"></div>
        </div>

        <div class="rail__row rail__row--stack">
          <div class="rail__k">Validation</div>
          <div class="rail__v rail__v--block" id="validationSummary">—</div>
          <button type="button" class="btn btn-ghost btn--full" id="jumpFirstMissing">Jump to first missing</button>
        </div>
      </div>

      <div class="card card--rail">
        <div class="rail__row">
          <div class="rail__k">Quick link</div>
          <div class="rail__v">
            <a class="link" href="#sec-equity" id="equityRailLink" style="display:none;">Equity addendum</a>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <script src="./app.js"></script>
</body>
</html>
